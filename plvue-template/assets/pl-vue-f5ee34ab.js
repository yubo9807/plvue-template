var wt=Object.defineProperty;var bt=(t,n,e)=>n in t?wt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var d=(t,n,e)=>(bt(t,typeof n!="symbol"?n+"":n,e),e),v=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)};var tt=(t,n,e)=>(v(t,n,"read from private field"),e?e.call(t):n.get(t)),et=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},_=(t,n,e,r)=>(v(t,n,"write to private field"),r?r.call(t,e):n.set(t,e),e);function L(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function m(t){return["object","array"].includes(L(t))}function St(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function $(t,n){if(m(t)&&m(n)){const e=Object.keys(t),r=Object.keys(n);if(e.length!==r.length)return!1;for(const o of e)if(!r.includes(o)||!$(t[o],n[o]))return!1;return!0}else return t===n}function ft(){return typeof window=="object"}function b(t){return L(t)==="object"}function I(t){return Array.isArray(t)}function T(t){return typeof t=="string"}function E(t){Promise.resolve().then(t)}function Rt(){return Number(Math.random().toString().slice(2)).toString(32)}function D(...t){console.warn(...t)}let C=null;const A=new WeakMap;function P(t){C=t,t(),C=null}function _t(t){const n=A.get(t)||[],e=n.some(r=>C===r);C&&!e&&(n.push(C),A.set(t,n))}function nt(t){const n=A.get(t);n&&n.forEach((e,r)=>{e()===!0&&(n.splice(r,1),A.set(t,n))})}const Et=new WeakMap,U=new WeakMap,x={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function K(t){if(!m(t)||Object.isFrozen(t))return D(`lue cannot be made reactive: ${t}`),t;if(Et.get(t))return t;let n=null;return new Proxy(t,{get(e,r,o){if(r===x.RAW)return e;if(m(e[r]))return K(e[r]);const s=Reflect.get(e,r,o);return _t(e),s},set(e,r,o,s){if(e[x.IS_READONLY])return!0;if(m(e[r])){const l=e[r],h=new Set;for(const y in o)h.add(y),this.set(l,y,o[y],s[r]);for(const y in l)h.has(y)||this.deleteProperty(l,y);return!0}if(Reflect.get(e,r,s)===o)return!0;const i=Reflect.set(e,r,o,s),u=U.get(e)||new Set;u.add(r);const a=u.size;return U.set(e,u),E(()=>{const l=Reflect.get(e,r,s);i&&l===o&&a===1&&nt(e),U.delete(e)}),i},deleteProperty(e,r){const o=Reflect.get(e,r);if(m(o)){for(const i in o)this.deleteProperty(o,i);return!0}const s=St(e,r),c=Reflect.deleteProperty(e,r);return n=r,E(()=>{s&&c&&o!==void 0&&r===n&&(nt(e),n=null)}),c}})}function kt(t){return!!t[x.RAW]}function at(t){return kt(t)?t[x.RAW]:t}function Ct(t){const n=K({value:t});function e(){return n.value}function r(o){n.value=o}return[e,r]}const jt="__v_isRef";var $t;class Ot{constructor(n){d(this,$t,!0);d(this,"__v_isShallow",!1);d(this,"_rawValue");d(this,"_value");d(this,"getSignal");d(this,"setSignal");this._rawValue=n;const[e,r]=Ct(n);this.getSignal=e,this.setSignal=r,this._value=e()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}$t=jt;function Mt(t){return new Ot(t)}const k=function(){const t=new WeakMap,n=["null","weakset","weakmap"],e={set(r){const o=new Set;for(const s of r)o.add(k(s));return o},map(r){const o=new Map;for(const[s,c]of r.entries())o.set(s,k(c));return o}};return function(r){const o=L(r);if(typeof r!="object"||n.includes(o))return r;if(t.has(r))return t.get(r);if(e[o])return e[o](r);const s=I(r)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(r)),t.set(r,s);for(const c in r)s[c]=k(r[c]);return s}}();function z(t,n){return Object.assign({},t,n)}function lt(t,n,e={}){let r=!1;if(r)return;const o=t();e.immediate&&n(o,void 0);let s=k(o),c=!0;return P(()=>{if(r)return!0;const i=t();if(m(i)){e.deep&&!$(i,s)&&(n(i,s),s=k(i));return}if(c){c=!1;return}i!==s&&(n(i,s),s=i)}),()=>{r=!0}}function j(t){return["string","number"].includes(typeof t)&&t!==""}function Nt(t){return!/^on/.test(t)}function Y(t){return b(t)&&(T(t.tag)||M(t.tag))}function p(t){return typeof t=="function"&&!M(t)}function Q(t){return[void 0,null,"",!0,!1].includes(t)}function O(t){return document.createTextNode(t)}function S(t,n,...e){const r={tag:t,attrs:n||{},children:e};return p(r.tag)&&(r.tag.prototype._id=Rt(),r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children)),r}function G(t){return t.prototype._id}function H({children:t}){return t}const F=Symbol("Fragment");H.prototype[F]=F;function M(t){return typeof t=="function"&&t.prototype[F]===F}const rt=[];function At(){rt.forEach(t=>{t()}),rt.length=0}const ht=new WeakMap;function pt(t,n=[]){return t.forEach(e=>{b(e)&&(p(e.tag)?n.push({comp:e.tag,compId:G(e.tag),props:z(e.attrs,{children:t})}):j(e.tag)&&pt(e.children,n))}),n}function J(t,n=[]){const e=ht.get(t)||[];return n.push(...e),e.forEach(r=>{const o=J(r.comp);n.push(...o)}),n}const Pt=new Map;function ot(t){const n=J(t).map(r=>r.compId);n.unshift(G(t));const e=[];n.forEach(r=>{const o=Pt.get(r)||[];e.push(...o)}),e.forEach(r=>{r()})}const st=[];function xt(){st.forEach(t=>{t()}),st.length=0}const Ft=new Map;function ct(t){const n=J(t).map(r=>r.compId);n.unshift(G(t));const e=[];n.forEach(r=>{const o=Ft.get(r)||[];e.push(...o)}),e.forEach(r=>{r()})}function R(t,n,e){if(T(t))return X(t,n,e);if(M(t))return V(e);if(p(t)){const r=z(n,{children:e}),o=t(r);return j(o)?O(o):(ht.set(t,pt(o.children)),R(o.tag,o.attrs,o.children))}}function X(t,n={},e=[""]){if(M(t))return R(t,n,e);const r=document.createElement(t);e.forEach(o=>{if(!Q(o)){if(j(o)){const s=O(o);s.nodeValue=o,r.appendChild(s);return}if(typeof o=="function"){const s=V([o]);r.appendChild(s);return}if(I(o)){const s=V(o);r.appendChild(s);return}if(Y(o)){const s=X(o.tag,o.attrs,o.children);r.appendChild(s);return}if(b(o)&&p(o.tag)){const s=R(o.tag,o.attrs,o.children);r.appendChild(s);return}D(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const s=n[o];s&&(r[o]=s,o==="ref"&&(s.value=r),typeof s=="function"&&Nt(o)&&P(()=>{r[o]=s()}))}if(n.style&&b(n.style))for(const o in n.style){const s=n.style[o];typeof s=="function"?P(()=>r.style[o]=s()):r.style[o]=s}return r}function V(t){const n=document.createDocumentFragment();return t.forEach(e=>{if(!Q(e)){if(j(e)){const r=O(e);r.nodeValue=e,n.appendChild(r);return}if(typeof e=="function"){Wt(n,e);return}if(I(e)){const r=V(e);n.appendChild(r);return}if(Y(e)){const r=X(e.tag,e.attrs,e.children);n.appendChild(r);return}if(b(e)&&p(e.tag)){const r=R(e.tag,e.attrs,e.children);n.appendChild(r);return}D(`render: 不支持 ${e} 值渲染`)}}),n}function it(t){if(j(t))return O(t);if(Y(t)||b(t)&&p(t.tag))return R(t.tag,t.attrs,t.children)}function Vt(t,n){let e=0,r=t.length-1;for(;e<=r;){var o=Math.ceil((e+r)/2);if(n===t[o].key)return o;n<t[o].key?r=o-1:n>t[o].key&&(e=o+1)}return-1}function Wt(t,n){let e=[],r=!0,o=null;const s=O("");t.appendChild(s),P(()=>{let c=n();if(c&&b(c)&&M(c.tag)){D("不支持响应式节点片段渲染");return}I(c)||(c=[c]),c=c.filter(u=>!Q(u));let i=0;for(;i<c.length;){let u=c[i];const a=Vt(e,i);if(a>=0){if($(u,e[a].tree)){i++;continue}const l=it(u);if(!l){c.splice(a,1),i++;continue}const h=e[a].tree;p(h.tag)&&ct(h.tag),e[a].node.parentElement.replaceChild(l,e[a].node),p(h.tag)&&ot(h.tag),e[a].tree=u,e[a].node=l}else{const l=it(u);if(!l){i++;continue}if(r)t.appendChild(l);else if(e.length===0)o??(o=s.parentElement),o.insertBefore(l,s.nextSibling);else{const h=e[e.length-1].node,y=h.nextSibling;h.parentElement.insertBefore(l,y)}e.push({key:i,tree:u,node:l})}i++}if(e.length>c.length){for(let u=c.length;u<e.length;u++){const a=e[u].tree;p(a.tag)&&ct(a.tag),e[u].node.remove(),p(a.tag)&&ot(a.tag)}e.splice(c.length,e.length-c.length)}r=!1})}function Yt({tag:t,attrs:n,children:e}){const r=R(t,n,e);return xt(),E(At),r}const W=Symbol("action");function It(t){return typeof t=="function"&&t.prototype[W]===W}var g;class Tt{constructor(n,e){d(this,"state");d(this,"actions");et(this,g,!0);this.state=K(k(n)),lt(()=>this.state,()=>{tt(this,g)&&this._merge(n)},{deep:!0}),this.actions={};for(const r in e){let s=function(...c){_(o,g,!1);const i=e[r](...c);if(o._merge(n),m(i)&&i[Symbol.toStringTag]==="Promise")i.then(u=>(o._merge(n),E(()=>_(o,g,!0)),u));else return o._merge(n),E(()=>_(o,g,!0)),i};const o=this;s.prototype[W]=W,this.actions[r]=s}}_merge(n){const e=Object.keys(n);for(const r in n)this.state[r]=n[r];for(const r in this.state)It(this.state[r])||!e.includes(r)&&delete this.state[r]}get store(){_(this,g,!1);const n=Object.assign(this.state,this.actions);return E(()=>_(this,g,!0)),n}}g=new WeakMap;function Qt(t,n){return()=>new Tt(t,n).store}function q(t){const n=new URL("http://0.0.0.0"+t),e=n.pathname,r=f.routes.find(o=>e.startsWith(o.path+"/")&&o.exact===!1);return{monitor:r?r.path:e,fullPath:n.href.replace(n.origin,""),path:e,query:Dt(n.search),hash:n.hash}}function Z(t){if(T(t))return t;t=t;const n=t.path;let e="";for(const s in t.query)e+=`&${s}=${t.query[s]}`;e=e?"?"+e:"";const r=t.hash?"#"+t.hash:"";return n+e+r}function Dt(t){const n={};return t.replace("?","").split("&").forEach(r=>{const[o,s]=r.split("=");o&&s&&(n[o]=s)}),n}function dt(){return f.mode==="history"?location.href.replace(location.origin+f.base,""):location.hash.slice(1)}function gt(t){const{routes:n}=f,e=n.find(o=>o.path===t);if(e)return e;const r=n[n.length-1];if(r.path===void 0&&r.component)return r}function yt(t){const n=Z(t);f.mode==="history"?history.pushState({},"",f.base+n):location.hash=n,B(n)}function mt(t){const n=Z(t);f.mode==="history"?history.replaceState({},"",f.base+n):location.hash=n,B(n)}function N(t){history.go(t)}function Kt(){return{push:yt,replace:mt,go:N}}const f={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let w=null;function Gt(t={}){if(Object.assign(f,t),ft()){const n=q(dt());w=K(n)}else w??(w=q("/"));return{back:()=>N(-1),forward:()=>N(1),go:N,push:yt,replace:mt,options:f,currentRoute:at(w)}}function B(t){const n=q(t);for(const e in n)w[e]=n[e]}let Bt,ut="/";function Ut(){let t="";if(f.mode==="history")t=ut.replace(f.base,"");else{const e=ut.match(/#.*/);t=e?e[0]:""}B(t);const n=gt(w.monitor);return S(H,null,n&&S(n.component,{data:Bt}))}function qt(t){window.addEventListener("popstate",()=>{B(dt())});const n=Mt(null);let e;return lt(()=>w.monitor,async r=>{const o=gt(r);if(!o)return;const{getInitialProps:s}=o.component.prototype;if(typeof s=="function")if(window[f.ssrDataKey])e=window[f.ssrDataKey],delete window[f.ssrDataKey];else{n.value=t.loading;const c=at(w);e=await s(c)}n.value=o.component},{immediate:!0}),S(H,null,()=>n.value&&S(n.value,{data:e}))}function Ht(t){return ft()?S(qt,{...t}):S(Ut,null)}const Lt={to:"/",type:"push"};function Jt(t){t=z(Lt,t);const n=T(t.to)?t.to:Z(t.to),e=f.base+(f.mode==="hash"?"#"+n:n),r=Kt();function o(s){s.preventDefault(),t.type==="push"?r.push(n):r.replace(n)}return S("a",{className:t.className,href:e,onclick:o},t.children)}export{H as F,Jt as L,Ht as R,Gt as a,Yt as b,Qt as c,S as h,Mt as r};
