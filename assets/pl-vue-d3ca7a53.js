var Nt=Object.defineProperty;var Tt=(t,n,e)=>n in t?Nt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var k=(t,n,e)=>(Tt(t,typeof n!="symbol"?n+"":n,e),e);function Rt(){return Number((Math.random()+"").slice(2)).toString(32)}function C(...t){console.warn(...t)}function p(t){return t.length}function nt(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function _(t){return["object","array"].includes(nt(t))}function Pt(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function rt(t,n){if(_(t)&&_(n)){const e=Object.keys(t),r=Object.keys(n);if(p(e)!==p(r))return!1;for(const o of e)if(!r.includes(o)||!rt(t[o],n[o]))return!1;return!0}else return t===n}function kt(){return typeof window=="object"}function R(t){return nt(t)==="object"}function F(t){return Array.isArray(t)}function I(t){return typeof t=="string"}function h(t){return typeof t=="function"}function Z(t){Promise.resolve().then(t)}function m(t){const n=new WeakMap,e=["null","weakset","weakmap"],r={function(c){const s=function(...i){return c.apply(this,i)};return s.prototype=o(c.prototype),s},set(c){const s=new Set;for(const i of c)s.add(o(i));return s},map(c){const s=new Map;for(const[i,u]of c.entries())s.set(i,o(u));return s}};function o(c){const s=nt(c);if(!["object","function"].includes(typeof c)||e.includes(s))return c;if(n.has(c))return n.get(c);if(r[s])return r[s](c);const i=F(c)?[]:{};Object.setPrototypeOf(i,Object.getPrototypeOf(c)),n.set(c,i);for(const u in c)i[u]=o(c[u]);return i}return o(t)}function V(t,n){return Object.assign({},t,n)}let N=null;const q=new WeakMap;function T(t){N=t,t(),N=null}function $t(t){const n=q.get(t)||[],e=n.some(r=>N===r);N&&!e&&(n.push(N),q.set(t,n))}function at(t){const n=q.get(t);n&&n.forEach((e,r)=>{e()===!0&&(n.splice(r,1),q.set(t,n))})}const Ct=new WeakMap,J=new WeakMap,L={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function W(t){if(!_(t)||Object.isFrozen(t))return C(`lue cannot be made reactive: ${t}`),t;if(Ct.get(t))return t;let n=null;return new Proxy(t,{get(e,r,o){if(r===L.RAW)return e;if(_(e[r]))return W(e[r]);const c=Reflect.get(e,r,o);return $t(e),c},set(e,r,o,c){if(e[L.IS_READONLY])return!0;if(_(e[r])){const l=e[r],E=new Set;for(const g in o)E.add(g),this.set(l,g,o[g],c[r]);for(const g in l)E.has(g)||this.deleteProperty(l,g);return!0}if(Reflect.get(e,r,c)===o)return!0;const i=Reflect.set(e,r,o,c),u=J.get(e)||new Set;u.add(r);const f=u.size;return J.set(e,u),Z(()=>{const l=Reflect.get(e,r,c);i&&l===o&&f===1&&at(e),J.delete(e)}),i},deleteProperty(e,r){const o=Reflect.get(e,r),c=Pt(e,r),s=Reflect.deleteProperty(e,r);return n=r,Z(()=>{c&&s&&o!==void 0&&r===n&&(at(e),n=null)}),s}})}function Ft(t){return R(t)&&!!t[L.RAW]}function P(t){return Ft(t)?t[L.RAW]:t}function It(t){const n={value:t},e=W(n);function r(){return e.value}function o(c){e.value=c}return[r,o,n]}const Wt="__v_isRef";var vt;class At{constructor(n){k(this,vt,!0);k(this,"__v_isShallow",!1);k(this,"_rawValue");k(this,"_value");k(this,"getSignal");k(this,"setSignal");const[e,r,o]=It(n);this._rawValue=o,this.getSignal=e,this.setSignal=r,this._value=e()}get value(){return this.getSignal()}set value(n){this.setSignal(n)}}vt=Wt;function Dt(t=void 0){return new At(t)}function Vt(t,n,e={}){let r=!1;if(r)return;const o=t();e.immediate&&n(o,void 0);let c=m(o),s=!0;return T(()=>{if(r)return!0;const i=t();if(_(i)){e.deep&&!rt(i,c)&&(n(i,c),c=m(i));return}if(s){s=!1;return}i!==c&&(n(i,c),c=i)}),()=>{r=!0}}function O(t){return["string","number"].includes(typeof t)&&t!==""}function v(t){return!/^on/.test(t)}function ot(t){return R(t)&&(I(t.tag)||j(t.tag))}function S(t){return h(t)&&!j(t)}function ct(t){return[void 0,null,"",!0,!1].includes(t)}function A(t){return document.createTextNode(t)}function w(t,n){t.appendChild(n)}function d(t,n,...e){const r={tag:t,attrs:n||{},children:e};return S(r.tag)&&p(r.children)===0&&r.attrs.children&&(r.children=r.attrs.children),r}function st(t){return t.prototype._id}function M({children:t}){return t}const B=Symbol("Fragment");M.prototype[B]=B;function j(t){return h(t)&&t.prototype[B]===B}const U=new WeakMap;function _t(t,n=[]){return t.forEach(e=>{R(e)&&(S(e.tag)?n.push({comp:e.tag,compId:st(e.tag),props:V(e.attrs,{children:t})}):O(e.tag)&&_t(e.children,n))}),n}function it(t,n=[]){const e=U.get(t)||[];return n.push(...e),e.forEach(r=>{const o=it(r.comp);n.push(...o)}),n}let lt=null;function qt(t,n){"ref"in n&&(n.ref.value=lt),lt=null}const pt=new Map;function ht(t){const n=it(t).map(r=>r.compId);n.unshift(st(t));const e=[];n.forEach(r=>{const o=pt.get(r)||[];e.push(...o),pt.delete(r)}),e.forEach(r=>{r()})}const dt=new Map;function mt(t){const n=it(t).map(r=>r.compId);n.unshift(st(t));const e=[];n.forEach(r=>{const o=dt.get(r)||[];e.push(...o),dt.delete(r)}),e.forEach(r=>{r()})}function x(t,n,e){if(I(t))return ut(t,n,e);if(j(t))return K(e);if(S(t)){t=t,t.prototype._id=Rt();const r=V(n,{children:e}),o=t(r);return qt(t,n),O(o)?A(o):(U.set(t,_t(o.children)),x(o.tag,o.attrs,o.children))}}function ut(t,n={},e=[""]){if(j(t))return x(t,n,e);const r=document.createElement(t);e.forEach(o=>{if(!ct(o)){if(O(o)){const c=A(o);c.nodeValue=o,w(r,c);return}if(h(o)){const c=K([o]);w(r,c);return}if(F(o)){const c=K(o);w(r,c);return}if(ot(o)){const c=ut(o.tag,o.attrs,o.children);w(r,c);return}if(R(o)&&S(o.tag)){const c=x(o.tag,o.attrs,o.children);w(r,c);return}C(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const c=n[o];if(![void 0,null].includes(c)){if(o==="ref"){c.value=r;continue}if(o==="created"&&h(c)){c(r);continue}if(o.startsWith("data-")){const s=o.slice(5);h(c)&&v(o)?T(()=>{r.dataset[s]=c()}):r.dataset[s]=c;continue}if(h(c)&&v(o)){T(()=>{r[o]=c()});continue}r[o]=c}}if(n.style&&R(n.style))for(const o in n.style){const c=n.style[o];h(c)?T(()=>r.style[o]=c()):r.style[o]=c}return r}function K(t){const n=document.createDocumentFragment();return t.forEach(e=>{if(!ct(e)){if(O(e)){const r=A(e);r.nodeValue=e,w(n,r);return}if(h(e)){Bt(n,e);return}if(F(e)){const r=K(e);w(n,r);return}if(ot(e)){const r=ut(e.tag,e.attrs,e.children);w(n,r);return}if(R(e)&&S(e.tag)){const r=x(e.tag,e.attrs,e.children);w(n,r);return}C(`render: 不支持 ${e} 值渲染`)}}),n}function yt(t){if(O(t))return A(t);if(ot(t)||R(t)&&S(t.tag))return x(t.tag,t.attrs,t.children)}function Lt(t,n){let e=0,r=p(t)-1;for(;e<=r;){var o=Math.ceil((e+r)/2);if(n===t[o].key)return o;n<t[o].key?r=o-1:n>t[o].key&&(e=o+1)}return-1}function Bt(t,n){let e=[],r=!0,o=null;const c=A("");w(t,c),T(()=>{let s=n();if(s&&R(s)&&j(s.tag)){C("不支持响应式节点片段渲染");return}F(s)||(s=[s]),s=s.filter(u=>!ct(u));let i=0;for(;i<p(s);){let u=s[i];const f=Lt(e,i);if(f>=0){if(rt(u,e[f].tree)){i++;continue}const l=yt(u);if(!l){s.splice(f,1),i++;continue}const E=e[f].tree;if(S(E.tag)&&ht(E.tag),e[f].node.parentElement.replaceChild(l,e[f].node),S(E.tag)){const g=E.tag;mt(g),U.delete(g)}e[f].tree=u,e[f].node=l}else{const l=yt(u);if(!l){i++;continue}if(r)w(t,l);else if(p(e)===0)o??(o=c.parentElement),o.insertBefore(l,c.nextSibling);else{const E=e[p(e)-1].node,g=E.nextSibling;E.parentElement.insertBefore(l,g)}e.push({key:i,tree:u,node:l})}i++}if(p(e)>p(s)){for(let u=p(s);u<p(e);u++){const f=e[u].tree;if(S(f.tag)&&ht(f.tag),e[u].node.remove(),S(f.tag)){const l=f.tag;mt(l),U.delete(l)}}e.splice(p(s),p(e)-p(s))}r=!1})}function ft(t,n={},e=[""]){if(j(t)){const c=V(n,{children:e}),s=t(c);return z(s)}if(S(t)){const c=V(n,{children:e}),s=t(c);return ft(s.tag,s.attrs,s.children)}let r="";for(const c in n){if(c.startsWith("on")||c==="ref")continue;let s=h(n[c])&&v(c)?n[c]():n[c];if(I(t)&&["innerHTML","innerText"].includes(c)){e=[s];continue}if(c==="className"){s&&(r+=` class="${s}"`);continue}if(c==="style"&&R(s)){for(const i in s)h(s[i])&&(s[i]=s[i]());s='"'+JSON.stringify(s).slice(1,-1).replace(/"/g,"").replace(/,/g,";")+'"'}r+=` ${c}="${s}"`}const o=z(e);return`<${t}${r}>${o}</${t}>`}function z(t){let n="";return t.forEach(e=>{if(O(e)){n+=e.toString();return}if(F(e)){n+=z(e);return}if(h(e)){const r=e();n+=z([r]);return}if(R(e)){n+=ft(e.tag,e.attrs,e.children);return}C(`renderToString: 不支持 ${e} 值渲染`)}),n}const gt=[];function Ut(){gt.forEach(t=>{t()}),gt.length=0}const bt=[];function Kt(){bt.forEach(t=>{t()}),bt.length=0}function ee({tag:t,attrs:n,children:e}){const r=x(t,n,e);return Ut(),Z(Kt),r}function zt({tag:t,attrs:n,children:e}){return ft(t,n,e)}function Ht(t){const n={};return t.replace(/([^?&=]+)=([^&]+)/g,(e,r,o)=>n[r]=o),n}function tt(t){const n=new URL("http://0.0.0.0"+t);return{fullPath:n.href.replace(n.origin,""),path:n.pathname,query:Ht(n.search),hash:n.hash,meta:{}}}function Yt(t){let n="";for(const r in t.query)t.query[r]&&(n+=`${r}=${t.query[r]}&`);n=n?"?"+n.slice(0,-1):"";let e=t.hash?"#"+t.hash:"";return t.path+n+e}function D(t){return t.replace(/\/{1,}/g,"/")}function xt(t,n){I(t)&&(y.mode==="history"&&(t=y.base+t),t=tt(t));for(const r in t)a[r]=t[r];const{fullPath:e}=a;y.mode==="history"?history[n==="push"?"pushState":"replaceState"]({},"",e):location.hash=e}function Mt(t){xt(t,"push")}function Ot(t){xt(t,"replace")}function Q(t){history.go(t)}function Gt(){return{back:()=>Q(-1),forward:()=>Q(1),go:Q,push:Mt,replace:Ot,options:y,currentRoute:P(a)}}const y={base:"",mode:"history",ssrDataKey:"g_initialProps"};let a=null;function wt(){const{origin:t,href:n,hash:e}=location;return y.mode==="hash"?e.replace("#",""):n.replace(t+y.base,"")}let $=null;function ne(t){if(Object.assign(y,t),kt()){const n=tt(wt());a=W(n),window.addEventListener("popstate",()=>{const e=tt(wt());for(const r in e)a[r]=e[r]})}return{...Gt(),beforeEach(n){$=n}}}const H={currentTemplate:"",ssrData:{}};function re(t){}function jt(t,n){n=n.replace(y.base,"");const e=t.find(i=>{const{path:u,exact:f}=i.attrs;return f===!1?(n+"/").startsWith(D(u+"/")):D(u)===n});if(!e)return;const{path:r,component:o,beforeEnter:c,meta:s}=e.attrs;return{path:D(r),component:o,meta:s,beforeEnter:c}}let b;const St=[];function Jt(t){const n=Dt();let e={};function r(c){const s=jt(t.children,c);if(!s){e={},n.value=t.notFound;return}async function i(){if(s.component.prototype||(s.component=(await s.component()).default),n.value===s.component)return;e.path=s.path;const u=et(s.component);if(u){const f=window[y.ssrDataKey];f&&e.path in f?(e.data=f[e.path],delete f[e.path]):e.data=await u(m(e))}n.value=s.component,e.meta=s.meta,a.meta=s.meta}if($){$(P(a),b,()=>{b=m(a),c===a.path?i():r(a.path)});return}if(s.beforeEnter){s.beforeEnter(P(a),b,()=>{b=m(a),c===a.path?i():r(a.path)});return}b=m(a),i()}const o=Vt(()=>a.path,c=>{if(b){const s=b.path.split("/"),i=c.split("/");s[1]!==i[1]&&St.forEach(u=>u())}r(c)},{immediate:!0});return t.prefix&&St.push(o),d(M,null,()=>d(n.value,{...e}))}const Y=W([]);function Qt(t){const n=jt(t.children,a.path);if(!n){const i=t.notFound;return d(i||M,null)}let e=!1;if($&&(e=!0,$(P(a),b,()=>{b=m(a),e=!1})),n.beforeEnter&&(e=!0,n.beforeEnter(P(a),b,()=>{b=m(a),e=!1})),e)return d(M,null);let r=n.component;a.meta=n.meta;const o={path:n.path,meta:n.meta},c=`r_${Rt()}`;if(!r.prototype)return Y.push(c),r().then(async i=>{r=i.default;const u=et(r);u&&(o.data=await u(m(o)),H.ssrData[o.path]=o.data),Et(c,r,o)}),d(M,null,c);const s=et(r);return s?(Y.push(c),s(m(o)).then(i=>{o.data=i,H.ssrData[o.path]=i,Et(c,r,o)}),d(M,null,c)):d(r,{...o})}function oe(t){return t.prefix&&t.children.forEach(n=>{n.attrs.path=D(t.prefix+n.attrs.path)}),kt()?d(Jt,{...t}):d(Qt,{...t})}function Et(t,n,e){const r=zt(d(n,{...e})),o=Y.indexOf(t);Y.splice(o,1);const c=H.currentTemplate.replace(t,r);H.currentTemplate=c}function et(t){const{getInitialProps:n}=t.prototype;if(n&&h(n))return n}function ce(t){I(t.to)||(t.to=Yt(t.to));const n=y.mode==="hash"?`${y.base}#${t.to}`:y.base+t.to;function e(r){r.preventDefault(),t.type==="replace"?Ot(t.to):Mt(t.to)}return d("a",{className:t.className,href:n,onclick:e},t.children)}const G=Symbol("action");function Xt(t){return h(t)&&t.prototype[G]===G}class Zt{constructor(n,e){k(this,"state");k(this,"actions");this.state=W(m(n)),this.actions={};for(const r in e){let c=function(...s){const i=e[r](...s);if(_(i)&&i[Symbol.toStringTag]==="Promise")i.then(u=>(o._merge(n),u));else return o._merge(n),i};const o=this;c.prototype[G]=G,o.actions[r]=c}Object.assign(this.state,this.actions);for(const r in this.actions)Object.defineProperty(this.state,r,{writable:!1})}_merge(n){const e=m(n),r=Object.keys(e);for(const o in e)this.state[o]=e[o];for(const o in this.state)Xt(this.state[o])||!r.includes(o)&&delete this.state[o]}}const X=new WeakMap;function se(t,n){return()=>{if(!X.has(t)){const e=new Zt(t,n);X.set(t,e.state)}return X.get(t)}}export{M as F,ce as L,oe as R,re as a,ee as b,se as c,d as h,ne as i,Dt as r};
