var Wt=Object.defineProperty;var At=(t,e,n)=>e in t?Wt(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var S=(t,e,n)=>(At(t,typeof e!="symbol"?e+"":e,n),n);function lt(){return Number((Math.random()+"").slice(2)).toString(32)}function G(...t){console.warn(...t)}function h(t){return t.length}function ot(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function Dt(t){return t.toString().slice(0,5)==="class"}function E(t){return["object","array"].includes(ot(t))}function qt(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function st(t,e){if(E(t)&&E(e)){const n=Object.keys(t),r=Object.keys(e);if(h(n)!==h(r))return!1;for(const o of n)if(!r.includes(o)||!st(t[o],e[o]))return!1;return!0}else return t===e}function it(){return typeof window=="object"}function g(t){return ot(t)==="object"}function J(t){return Array.isArray(t)}function C(t){return typeof t=="string"}function d(t){return typeof t=="function"}function et(t){Promise.resolve().then(t)}function w(t,e={}){const n=g(t)?new WeakMap:new Map,r=["null","regexp","date","weakset","weakmap"],o=Object.assign({function(c){const u=function(...a){return c.apply(this,a)};return u.prototype=s(c.prototype),u},set(c){const u=new Set;for(const a of c)u.add(s(a));return u},map(c){const u=new Map;for(const[a,f]of c.entries())u.set(a,s(f));return u}},e);function s(c){const u=ot(c);if(!["object","function"].includes(typeof c)||r.includes(u))return c;if(n.has(t))return n.get(t);if(o[u])return o[u](c);const a=J(c)?[]:{};Object.setPrototypeOf(a,Object.getPrototypeOf(c)),n.set(t,a);for(const f in c)a[f]=s(c[f]);return a}const i=s(t);return n.delete(t),i}function q(t,e){return Object.assign({},t,e)}function p(t,e,n){let r=0;for(;r<t.length;){if(t.hasOwnProperty(r)){const o=t[r];e.apply(n,[o,r,n])}r++}}let T=null;const I=new WeakMap;function Q(t){T=t,t(),T=null}function It(t){const e=I.get(t)||[],n=e.some(r=>T===r);T&&!n&&(e.push(T),I.set(t,e))}function pt(t){const e=I.get(t);e&&p(e,(n,r)=>{n()===!0&&(e.splice(r,1),I.set(t,e))})}const Lt=new WeakMap,Z=new WeakMap,L={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function $(t){if(!E(t)||Object.isFrozen(t))return G(`lue cannot be made reactive: ${t}`),t;if(Lt.get(t))return t;let e=null;return new Proxy(t,{get(n,r,o){if(r===L.RAW)return n;const s=Reflect.get(n,r,o);return It(n),E(s)?$(s):s},set(n,r,o,s){if(n[L.IS_READONLY]||Reflect.get(n,r,s)===o)return!0;const c=Reflect.set(n,r,o,s),u=Z.get(n)||new Set;u.add(r);const a=u.size;return Z.set(n,u),et(()=>{c&&a===1&&pt(n),Z.delete(n)}),c},deleteProperty(n,r){const o=Reflect.get(n,r),s=qt(n,r),i=Reflect.deleteProperty(n,r);return e=r,et(()=>{s&&i&&o!==void 0&&r===e&&(pt(n),e=null)}),i}})}function Vt(t){return g(t)&&!!t[L.RAW]}function ct(t){return Vt(t)?t[L.RAW]:t}function Bt(t){const e={value:t},n=$(e);function r(){return n.value}function o(s){n.value=s}return[r,o,e]}const Ut="__v_isRef";var ue;class Kt{constructor(e){S(this,ue,!0);S(this,"__v_isShallow",!1);S(this,"_rawValue");S(this,"_value");S(this,"getSignal");S(this,"setSignal");const[n,r,o]=Bt(e);this._rawValue=o,this.getSignal=n,this.setSignal=r,this._value=n()}get value(){return this.getSignal()}set value(e){this.setSignal(e)}}ue=Ut;function zt(t=void 0){return new Kt(t)}function Ht(t,e,n={}){let r=!1;if(r)return;const o=t();n.immediate&&e(o,void 0);let s=w(o),i=!0;return Q(()=>{if(r)return!0;const c=t();if(E(c)){n.deep&&!st(c,s)&&(e(c,s),s=w(c));return}if(i){i=!1;return}c!==s&&(e(c,s),s=c)}),()=>{r=!0}}function P(t){return["string","number"].includes(typeof t)&&t!==""}function Ot(t){return!/^on/.test(t)}function jt(t){return g(t)&&(C(t.tag)||N(t.tag))}function b(t){return d(t)&&!N(t)}function xt(t){return Dt(t)&&t.prototype&&t.prototype.render}function Mt(t){return[void 0,null,"",!0,!1].includes(t)}function Et(...t){return t.filter(n=>P(n)).join(" ").trim().replace(/\s+/," ")}function X(t){return document.createTextNode(t)}function j(t,e){t.appendChild(e)}function m(t,e,...n){const r={tag:t,attrs:e||{},children:n};return b(r.tag)&&h(r.children)===0&&r.attrs.children&&(r.children=r.attrs.children),r}function M({children:t}){return t}const V=Symbol("Fragment");M.prototype[V]=V;function N(t){return d(t)&&t.prototype&&t.prototype[V]===V}const B=new WeakMap;function Ct(t,e=[]){return p(t,n=>{g(n)&&(b(n.tag)?(e.push({comp:n.tag,props:q(n.attrs,{children:t})}),p(n.children,r=>{b(r)&&e.push({comp:r,props:{}})})):P(n.tag)&&Ct(n.children,e))}),e}function ut(t,e=[]){const n=B.get(t)||[];return e.push(...n),p(n,r=>{const o=ut(r.comp);e.push(...o)}),e}let ht=null;function Yt(t,e){"ref"in e&&(e.ref.value=ht),ht=null}const dt=new WeakMap;function mt(t){const e=ut(t).map(r=>r.comp);e.unshift(t);const n=[];p(e,r=>{const o=dt.get(r)||[];n.push(...o),dt.delete(r)}),p(n,r=>r())}const yt=new WeakMap;function gt(t){const e=ut(t).map(r=>r.comp);e.unshift(t);const n=[];p(e,r=>{const o=yt.get(r)||[];n.push(...o),yt.delete(r)}),p(n,r=>r())}function x(t,e,n){if(C(t))return Pt(t,e,n);if(d(t)){if(t=t,N(t))return at(n);if(xt(t))return x(t.prototype.render,e,n);const r=q(e,{children:n}),o=t(r);return Yt(t,e),P(o)?X(o):(B.set(t,Ct([o,...o.children])),x(o.tag,o.attrs,o.children))}}function Pt(t,e={},n=[""]){if(d(t)&&N(t))return x(t,e,n);const r=document.createElement(t);p(n,o=>{if(d(o)){const s=at([o]);j(r,s)}else Nt(r,o)});for(const o in e)Gt(r,o,e[o]);if(e.style&&g(e.style))for(const o in e.style){const s=e.style[o];d(s)?Q(()=>r.style[o]=s()):r.style[o]=s}return r}function Gt(t,e,n){if(e==="ref"&&g(n)){n.value=t;return}if(e==="created"&&d(n)){n(t);return}let r=o=>t[e]=o;e==="className"?r=o=>t[e]=Et(...[o].flat()):e.startsWith("data-")&&(r=o=>t.dataset[e.slice(5)]=o),Ot(e)&&d(n)?Q(()=>r(n())):r(n)}function at(t){const e=document.createDocumentFragment();return p(t,n=>{d(n)?Qt(e,n):Nt(e,n)}),e}function Nt(t,e){if(!Mt(e)){if(P(e)){const n=X(e);n.nodeValue=e,j(t,n);return}if(J(e)){const n=at(e);j(t,n);return}if(jt(e)){const n=Pt(e.tag,e.attrs,e.children);j(t,n);return}if(g(e)&&b(e.tag)){const n=x(e.tag,e.attrs,e.children);j(t,n);return}G(`render: 不支持 ${e} 值渲染`)}}function bt(t){if(P(t))return X(t);if(jt(t)||g(t)&&b(t.tag))return x(t.tag,t.attrs,t.children)}function Jt(t,e){let n=0,r=h(t)-1;for(;n<=r;){const o=Math.ceil((n+r)/2),s=t[o];if(e===s.key)return o;e<s.key?r=o-1:e>s.key&&(n=o+1)}return-1}function Qt(t,e){let n=[],r=!0,o=null;const s=X("");j(t,s),Q(()=>{let i=e();if(i&&g(i)&&N(i.tag)){G("不支持响应式节点片段渲染");return}J(i)||(i=[i]),i=i.filter(u=>!Mt(u));let c=0;for(;c<h(i);){let u=i[c];const a=Jt(n,c);if(a>=0){if(st(u,n[a].tree)){c++;continue}const f=bt(u);if(!f){i.splice(a,1),c++;continue}const k=n[a].tree;if(b(k.tag)&&mt(k.tag),n[a].node.parentElement.replaceChild(f,n[a].node),b(k.tag)){const W=k.tag;gt(W),B.delete(W)}n[a].tree=u,n[a].node=f}else{const f=bt(u);if(!f){c++;continue}if(r)j(t,f);else if(h(n)===0)o??(o=s.parentElement),o.insertBefore(f,s.nextSibling);else{const k=n[h(n)-1].node,W=k.nextSibling;k.parentElement.insertBefore(f,W)}n.push({key:c,tree:u,node:f})}c++}if(h(n)>h(i)){for(let u=h(i);u<h(n);u++){const a=n[u].tree;if(b(a.tag)&&mt(a.tag),n[u].node.remove(),b(a.tag)){const f=a.tag;gt(f),B.delete(f)}}n.splice(h(i),h(n)-h(i))}r=!1})}function U(t,e={},n=[""]){if(N(t)){const s=q(e,{children:n}),i=t(s);return K(i)}if(b(t)){if(t=t,xt(t))return U(t.prototype.render,{},[]);const s=q(e,{children:n}),i=t(s);return U(i.tag,i.attrs,i.children)}let r="";for(const s in e){if(s.startsWith("on")||s==="ref")continue;let i=d(e[s])&&Ot(s)?e[s]():e[s];if(C(t)&&["innerHTML","innerText"].includes(s)){n=[i];continue}if(s==="className"){i&&(r+=` class="${Et(...[i].flat())}"`);continue}if(s==="style"&&g(i)){for(const c in i)d(i[c])&&(i[c]=i[c]());i='"'+JSON.stringify(i).slice(1,-1).replace(/"/g,"").replace(/,/g,";")+'"'}r+=` ${s}="${i}"`}const o=K(n);return`<${t}${r}>${o}</${t}>`}function K(t){let e="";return p(t,n=>{if(P(n)){e+=n.toString();return}if(J(n)){e+=K(n);return}if(d(n)){const r=n();e+=K([r]);return}if(g(n)){e+=U(n.tag,n.attrs,n.children);return}G(`renderToString: 不支持 ${n} 值渲染`)}),e}const wt=[];function Xt(){p(wt,t=>t()),wt.length=0}const St=[];function Zt(){p(St,t=>t()),St.length=0}function fe({tag:t,attrs:e,children:n}){const r=x(t,e,n);return Xt(),et(Zt),r}function vt({tag:t,attrs:e,children:n}){return U(t,e,n)}function te(t){const e={};return t.replace(/([^?&=]+)=([^&]+)/g,(n,r,o)=>e[r]=o),e}function z(t){const e=new URL("http://0.0.0.0"+t);return{fullPath:e.href.replace(e.origin,""),path:e.pathname,query:te(e.search),hash:e.hash,meta:{}}}function ee(t){let e="";for(const r in t.query)t.query[r]&&(e+=`${r}=${t.query[r]}&`);e=e?"?"+e.slice(0,-1):"";let n=t.hash?"#"+t.hash:"";return t.path+e+n}function D(t){return t.replace(/\/{1,}/g,"/")}function Tt(t,e){C(t)&&(y.mode==="history"&&(t=y.base+t),t=z(t));for(const r in t)l[r]=t[r];const{fullPath:n}=l;it()&&(y.mode==="history"?history[e==="push"?"pushState":"replaceState"]({},"",n):location.hash=n)}function _t(t){Tt(t,"push")}function ft(t){Tt(t,"replace")}function v(t){history.go(t)}function ne(){return{back:()=>v(-1),forward:()=>v(1),go:v,push:_t,replace:ft,options:y,currentRoute:ct(l)}}function re(){return l}const y={base:"",mode:"history",ssrDataKey:"g_initialProps"};let l=null;function oe(t){l=t}function Rt(){const{origin:t,href:e,hash:n}=location;return y.mode==="hash"?n.replace("#",""):e.replace(t+y.base,"")}let F=null;function le(t={}){if(Object.assign(y,t),it()){const e=z(Rt());l=$(e),window.addEventListener("popstate",()=>{const n=z(Rt());for(const r in n)l[r]=n[r]})}return{...ne(),beforeEach(e){F=e}}}const H={currentTemplate:"",ssrData:{}};function pe(t){}function Ft(t,e){e=e.replace(y.base,"");const n=t.find(u=>{const{path:a,exact:f}=u.attrs;return f===!1?(e+"/").startsWith(D(a+"/")):D(a)===e});if(!n)return;const{path:r,component:o,beforeEnter:s,meta:i,redirect:c}=n.attrs;return{path:D(r),component:o,meta:i,beforeEnter:s,redirect:c}}let O;const kt=[];function se(t){const e=zt();let n={};function r(s){const i=Ft(t.children,s);if(!i){n={},e.value=t.notFound;return}async function c(){if(i.component.prototype||(i.component=(await i.component()).default),e.value===i.component)return;n.path=i.path;const a=rt(i.component);if(a){const f=window[y.ssrDataKey];f&&n.path in f?(n.data=f[n.path],delete f[n.path]):n.data=await a(w(n))}e.value=i.component,n.meta=i.meta,l.meta=i.meta}if(i.redirect&&i.redirect!==l.fullPath){ft(i.redirect),r(l.path);return}function u(a){a(ct(l),O,()=>{O=w(l),s===l.path?c():r(l.path)})}if(F){u(F);return}if(i.beforeEnter){u(i.beforeEnter);return}O=w(l),c()}const o=Ht(()=>l.path,s=>{if(O){const i=O.path.split("/"),c=s.split("/");i[1]!==c[1]&&p(kt,u=>u())}r(s)},{immediate:!0});return t.prefix&&kt.push(o),m(M,null,()=>m(e.value,{...n}))}const _=$([]);function nt(t){const e=_.indexOf(t);_.splice(e,1)}let R=null;function $t(t){function e(c){let u=Ft(t.children,c);if(u.redirect&&u.redirect!==l.fullPath)return oe(z(u.redirect)),e(l.path);function a(f){return R=`b_${lt()}`,_.push(R),f(ct(l),O,()=>{O=w(l),u.path!==l.path?$t(t):(A(R,u.component,{path:u.path,meta:u.meta}),nt(R))}),R}return F?a(F):u.beforeEnter?a(u.beforeEnter):u}let n=e(l.path);if(C(n))return m(M,null,n);if(!n){const c=t.notFound;return m(c||M,null)}n=n;let r=n.component;l.meta=n.meta;const o={path:n.path,meta:n.meta};R&&(A(R,r,o),nt(R));const s=`r_${lt()}`;if(!r.prototype)return _.push(s),r().then(async c=>{r=c.default;const u=rt(r);u&&(o.data=await u(w(o)),H.ssrData[o.path]=o.data),A(s,r,o)}),m(M,null,s);const i=rt(r);return i?(_.push(s),i(w(o)).then(c=>{o.data=c,H.ssrData[o.path]=c,A(s,r,o)}),m(M,null,s)):m(r,{...o})}function he(t){return p(t.children,e=>{t.prefix&&(e.attrs.path=D(t.prefix+e.attrs.path)),e.children=[e.attrs.component]}),it()?m(se,{...t}):m($t,{...t})}function A(t,e,n){const r=vt(m(e,{...n}));nt(t);const o=H.currentTemplate.replace(t,r);H.currentTemplate=o}function rt(t){const{getInitialProps:e}=t.prototype;if(e&&d(e))return e}function de(t){const{to:e,type:n,className:r,children:o,...s}=t,i=re();C(e)||(t.to=ee(Object.assign({},i,e)));const c=y.mode==="hash"?`${y.base}#${t.to}`:y.base+t.to;function u(a){a.preventDefault(),n==="replace"?ft(t.to):_t(t.to)}return m("a",{className:()=>{const a=t.to+"/",f=i.path+"/";return[f.startsWith(a)&&"active",f===a&&"exact-active",r]},href:c,onclick:u,...s},o)}const Y=Symbol("action");function ie(t){return d(t)&&t.prototype[Y]===Y}class ce{constructor(e,n){S(this,"state");S(this,"actions");this.state=$(w(e)),this.actions={};for(const r in n){let s=function(...i){const c=n[r](...i);if(E(c)&&c[Symbol.toStringTag]==="Promise")c.then(u=>(o._merge(e),u));else return o._merge(e),c};const o=this;s.prototype[Y]=Y,o.actions[r]=s}Object.assign(this.state,this.actions);for(const r in this.actions)Object.defineProperty(this.state,r,{writable:!1})}_merge(e){const n=w(e),r=Object.keys(n);for(const o in n)this.state[o]=n[o];for(const o in this.state)ie(this.state[o])||!r.includes(o)&&delete this.state[o]}}const tt=new WeakMap;function me(t,e){return()=>{if(!tt.has(t)){const n=new ce(t,e);tt.set(t,n.state)}return tt.get(t)}}export{M as F,de as L,he as R,pe as a,fe as b,me as c,m as h,le as i,zt as r};
