var $t=Object.defineProperty;var Ft=(t,n,e)=>n in t?$t(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var E=(t,n,e)=>(Ft(t,typeof n!="symbol"?n+"":n,e),e),ft=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)};var at=(t,n,e)=>(ft(t,n,"read from private field"),e?e.call(t):n.get(t)),lt=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},I=(t,n,e,r)=>(ft(t,n,"write to private field"),r?r.call(t,e):n.set(t,e),e);function et(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function R(t){return["object","array"].includes(et(t))}function At(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function nt(t,n){if(R(t)&&R(n)){const e=Object.keys(t),r=Object.keys(n);if(e.length!==r.length)return!1;for(const o of e)if(!r.includes(o)||!nt(t[o],n[o]))return!1;return!0}else return t===n}function kt(){return typeof window=="object"}function S(t){return et(t)==="object"}function T(t){return Array.isArray(t)}function J(t){return typeof t=="string"}function h(t){return typeof t=="function"}function M(t){Promise.resolve().then(t)}function y(t){const n=new WeakMap,e=["null","weakset","weakmap"],r={set(s){const i=new Set;for(const c of s)i.add(o(c));return i},map(s){const i=new Map;for(const[c,u]of s.entries())i.set(c,o(u));return i}};function o(s){const i=et(s);if(typeof s!="object"||e.includes(i))return s;if(n.has(s))return n.get(s);if(r[i])return r[i](s);const c=T(s)?[]:{};Object.setPrototypeOf(c,Object.getPrototypeOf(s)),n.set(s,c);for(const u in s)c[u]=o(s[u]);return c}return o(t)}function D(t,n){return Object.assign({},t,n)}function Ct(){return Number(Math.random().toString().slice(2)).toString(32)}function $(...t){console.warn(...t)}let x=null;const V=new WeakMap;function q(t){x=t,t(),x=null}function It(t){const n=V.get(t)||[],e=n.some(r=>x===r);x&&!e&&(n.push(x),V.set(t,n))}function pt(t){const n=V.get(t);n&&n.forEach((e,r)=>{e()===!0&&(n.splice(r,1),V.set(t,n))})}const Wt=new WeakMap,Q=new WeakMap,L={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function F(t){if(!R(t)||Object.isFrozen(t))return $(`lue cannot be made reactive: ${t}`),t;if(Wt.get(t))return t;let n=null;return new Proxy(t,{get(e,r,o){if(r===L.RAW)return e;if(R(e[r]))return F(e[r]);const s=Reflect.get(e,r,o);return It(e),s},set(e,r,o,s){if(e[L.IS_READONLY])return!0;if(R(e[r])){const l=e[r],w=new Set;for(const m in o)w.add(m),this.set(l,m,o[m],s[r]);for(const m in l)w.has(m)||this.deleteProperty(l,m);return!0}if(Reflect.get(e,r,s)===o)return!0;const c=Reflect.set(e,r,o,s),u=Q.get(e)||new Set;u.add(r);const f=u.size;return Q.set(e,u),M(()=>{const l=Reflect.get(e,r,s);c&&l===o&&f===1&&pt(e),Q.delete(e)}),c},deleteProperty(e,r){const o=Reflect.get(e,r);if(R(o)){for(const c in o)this.deleteProperty(o,c);return!0}const s=At(e,r),i=Reflect.deleteProperty(e,r);return n=r,M(()=>{s&&i&&o!==void 0&&r===n&&(pt(e),n=null)}),i}})}function Dt(t){return S(t)&&!!t[L.RAW]}function N(t){return Dt(t)?t[L.RAW]:t}function Vt(t){const n=F({value:t});function e(){return n.value}function r(o){n.value=o}return[e,r]}const qt="__v_isRef";var ne;class Lt{constructor(n){E(this,ne,!0);E(this,"__v_isShallow",!1);E(this,"_rawValue");E(this,"_value");E(this,"getSignal");E(this,"setSignal");this._rawValue=n;const[e,r]=Vt(n);this.getSignal=e,this.setSignal=r,this._value=e()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}ne=qt;function Bt(t=void 0){return new Lt(t)}function Ot(t,n,e={}){let r=!1;if(r)return;const o=t();e.immediate&&n(o,void 0);let s=y(o),i=!0;return q(()=>{if(r)return!0;const c=t();if(R(c)){e.deep&&!nt(c,s)&&(n(c,s),s=y(c));return}if(i){i=!1;return}c!==s&&(n(c,s),s=c)}),()=>{r=!0}}function O(t){return["string","number"].includes(typeof t)&&t!==""}function jt(t){return!/^on/.test(t)}function rt(t){return S(t)&&(J(t.tag)||j(t.tag))}function b(t){return h(t)&&!j(t)}function ot(t){return[void 0,null,"",!0,!1].includes(t)}function A(t){return document.createTextNode(t)}function p(t,n,...e){const r={tag:t,attrs:n||{},children:e};return b(r.tag)&&r.children.length===0&&r.attrs.children&&(r.children=r.attrs.children),r}function st(t){return t.prototype._id}function C({children:t}){return t}const B=Symbol("Fragment");C.prototype[B]=B;function j(t){return h(t)&&t.prototype[B]===B}const U=new WeakMap;function xt(t,n=[]){return t.forEach(e=>{S(e)&&(b(e.tag)?n.push({comp:e.tag,compId:st(e.tag),props:D(e.attrs,{children:t})}):O(e.tag)&&xt(e.children,n))}),n}function it(t,n=[]){const e=U.get(t)||[];return n.push(...e),e.forEach(r=>{const o=it(r.comp);n.push(...o)}),n}let ht=null;function Ut(t,n){"ref"in n&&(n.ref.value=ht),ht=null}const dt=new Map;function mt(t){const n=it(t).map(r=>r.compId);n.unshift(st(t));const e=[];n.forEach(r=>{const o=dt.get(r)||[];e.push(...o),dt.delete(r)}),e.forEach(r=>{r()})}const gt=new Map;function yt(t){const n=it(t).map(r=>r.compId);n.unshift(st(t));const e=[];n.forEach(r=>{const o=gt.get(r)||[];e.push(...o),gt.delete(r)}),e.forEach(r=>{r()})}function k(t,n,e){if(J(t))return ct(t,n,e);if(j(t))return K(e);if(b(t)){t=t,t.prototype._id=Ct();const r=D(n,{children:e}),o=t(r);return Ut(t,n),O(o)?A(o):(U.set(t,xt(o.children)),k(o.tag,o.attrs,o.children))}}function ct(t,n={},e=[""]){if(j(t))return k(t,n,e);const r=document.createElement(t);e.forEach(o=>{if(!ot(o)){if(O(o)){const s=A(o);s.nodeValue=o,r.appendChild(s);return}if(h(o)){const s=K([o]);r.appendChild(s);return}if(T(o)){const s=K(o);r.appendChild(s);return}if(rt(o)){const s=ct(o.tag,o.attrs,o.children);r.appendChild(s);return}if(S(o)&&b(o.tag)){const s=k(o.tag,o.attrs,o.children);r.appendChild(s);return}$(`render: 不支持 ${o} 值渲染`)}});for(const o in n){const s=n[o];if(![void 0,null].includes(s)){if(o.startsWith("data-")){r.dataset[o.slice(5)]=s;continue}if(o==="ref"){s.value=r;continue}if(o==="created"&&h(s)){s(r);continue}if(h(s)&&jt(o)){q(()=>{r[o]=s()});continue}r[o]=s}}if(n.style&&S(n.style))for(const o in n.style){const s=n.style[o];h(s)?q(()=>r.style[o]=s()):r.style[o]=s}return r}function K(t){const n=document.createDocumentFragment();return t.forEach(e=>{if(!ot(e)){if(O(e)){const r=A(e);r.nodeValue=e,n.appendChild(r);return}if(h(e)){zt(n,e);return}if(T(e)){const r=K(e);n.appendChild(r);return}if(rt(e)){const r=ct(e.tag,e.attrs,e.children);n.appendChild(r);return}if(S(e)&&b(e.tag)){const r=k(e.tag,e.attrs,e.children);n.appendChild(r);return}$(`render: 不支持 ${e} 值渲染`)}}),n}function bt(t){if(O(t))return A(t);if(rt(t)||S(t)&&b(t.tag))return k(t.tag,t.attrs,t.children)}function Kt(t,n){let e=0,r=t.length-1;for(;e<=r;){var o=Math.ceil((e+r)/2);if(n===t[o].key)return o;n<t[o].key?r=o-1:n>t[o].key&&(e=o+1)}return-1}function zt(t,n){let e=[],r=!0,o=null;const s=A("");t.appendChild(s),q(()=>{let i=n();if(i&&S(i)&&j(i.tag)){$("不支持响应式节点片段渲染");return}T(i)||(i=[i]),i=i.filter(u=>!ot(u));let c=0;for(;c<i.length;){let u=i[c];const f=Kt(e,c);if(f>=0){if(nt(u,e[f].tree)){c++;continue}const l=bt(u);if(!l){i.splice(f,1),c++;continue}const w=e[f].tree;if(b(w.tag)&&mt(w.tag),e[f].node.parentElement.replaceChild(l,e[f].node),b(w.tag)){const m=w.tag;yt(m),U.delete(m)}e[f].tree=u,e[f].node=l}else{const l=bt(u);if(!l){c++;continue}if(r)t.appendChild(l);else if(e.length===0)o??(o=s.parentElement),o.insertBefore(l,s.nextSibling);else{const w=e[e.length-1].node,m=w.nextSibling;w.parentElement.insertBefore(l,m)}e.push({key:c,tree:u,node:l})}c++}if(e.length>i.length){for(let u=i.length;u<e.length;u++){const f=e[u].tree;if(b(f.tag)&&mt(f.tag),e[u].node.remove(),b(f.tag)){const l=f.tag;yt(l),U.delete(l)}}e.splice(i.length,e.length-i.length)}r=!1})}function ut(t,n={},e=[""]){if(j(t)){const s=D(n,{children:e}),i=t(s);return z(i)}if(b(t)){const s=D(n,{children:e}),i=t(s);return ut(i.tag,i.attrs,i.children)}let r="";for(const s in n){if(s.startsWith("on")||s==="ref")continue;let i=h(n[s])&&jt(s)?n[s]():n[s];if(s==="className"){i&&(r+=` class="${i}"`);continue}if(s==="style"&&S(i)){for(const c in i)h(i[c])&&(i[c]=i[c]());i='"'+JSON.stringify(i).slice(1,-1).replaceAll('"',"").replaceAll(",",";")+'"'}r+=` ${s}="${i}"`}const o=z(e);return`<${t}${r}>${o}</${t}>`}function z(t){let n="";return t.forEach(e=>{if(O(e)){n+=e.toString();return}if(T(e)){n+=z(e);return}if(h(e)){const r=e();n+=z([r]);return}if(S(e)){n+=ut(e.tag,e.attrs,e.children);return}$(`renderToString: 不支持 ${e} 值渲染`)}),n}const wt=[];function Ht(){wt.forEach(t=>{t()}),wt.length=0}const St=[];function Yt(){St.forEach(t=>{t()}),St.length=0}function oe({tag:t,attrs:n,children:e}){const r=k(t,n,e);return Ht(),M(Yt),r}function Gt({tag:t,attrs:n,children:e}){return ut(t,n,e)}function Jt(t){const n={};return t.replace(/([^?&=]+)=([^&]+)/g,(e,r,o)=>n[r]=o),n}function v(t){const n=new URL("http://0.0.0.0"+t);return{fullPath:n.href.replace(n.origin,""),path:n.pathname,query:Jt(n.search),hash:n.hash,meta:{}}}function Qt(t){let n="";for(const r in t.query)t.query[r]&&(n+=`${r}=${t.query[r]}&`);n=n?"?"+n.slice(0,-1):"";let e=t.hash?"#"+t.hash:"";return t.path+n+e}function W(t){return t.replace(/\/{1,}/g,"/")}function Mt(t,n){J(t)&&(d.mode==="history"&&(t=d.base+t),t=v(t));for(const r in t)a[r]=t[r];const{fullPath:e}=a;d.mode==="history"?history[n==="push"?"pushState":"replaceState"]({},"",e):location.hash=e}function Nt(t){Mt(t,"push")}function Pt(t){Mt(t,"replace")}function X(t){history.go(t)}function Xt(){return{back:()=>X(-1),forward:()=>X(1),go:X,push:Nt,replace:Pt,options:d,currentRoute:N(a)}}const d={base:"",mode:"history",ssrDataKey:"g_initialProps"};let a=null;function Et(){const{origin:t,href:n,hash:e}=location;return d.mode==="hash"?e.replace("#",""):n.replace(t+d.base,"")}let P=null;function se(t){if(Object.assign(d,t),kt()){const n=v(Et());a=F(n),window.addEventListener("popstate",()=>{const e=v(Et());for(const r in e)a[r]=e[r]})}return{...Xt(),beforeEach(n){P=n}}}const H={currentTemplate:"",ssrData:{}};function ie(t){}function Tt(t,n){n=n.replace(d.base,"");const e=t.find(c=>{const{path:u,exact:f}=c.attrs;return f===!1?(n+"/").startsWith(W(u+"/")):W(u)===n});if(!e)return;const{path:r,component:o,beforeEnter:s,meta:i}=e.attrs;return{path:W(r),component:o,meta:i,beforeEnter:s}}let g;const Rt=[];function Zt(t){const n=Bt();let e={};function r(s){const i=Tt(t.children,s);if(!i){e={},n.value=t.notFound;return}async function c(){if(i.component.prototype||(i.component=(await i.component()).default),n.value===i.component)return;e.path=i.path;const u=tt(i.component);if(u){const f=window[d.ssrDataKey];f&&e.path in f?(e.data=f[e.path],delete f[e.path]):e.data=await u(y(e))}n.value=i.component,e.meta=i.meta,a.meta=i.meta}if(P){P(N(a),g,()=>{g=y(a),s===a.path?c():r(a.path)});return}if(i.beforeEnter){i.beforeEnter(N(a),g,()=>{g=y(a),s===a.path?c():r(a.path)});return}g=y(a),c()}const o=Ot(()=>a.path,s=>{if(g){const i=g.path.split("/"),c=s.split("/");i[1]!==c[1]&&Rt.forEach(u=>u())}r(s)},{immediate:!0});return t.prefix&&Rt.push(o),p(C,null,()=>p(n.value,{...e}))}const Y=F([]);function vt(t){const n=Tt(t.children,a.path);if(!n){const c=t.notFound;return p(c||C,null)}let e=!1;if(P&&(e=!0,P(N(a),g,()=>{g=y(a),e=!1})),n.beforeEnter&&(e=!0,n.beforeEnter(N(a),g,()=>{g=y(a),e=!1})),e)return p(C,null);let r=n.component;a.meta=n.meta;const o={path:n.path,meta:n.meta},s=`r_${Ct()}`;if(!r.prototype)return Y.push(s),r().then(async c=>{r=c.default;const u=tt(r);u&&(o.data=await u(y(o)),H.ssrData[o.path]=o.data),_t(s,r,o)}),p(C,null,s);const i=tt(r);return i?(Y.push(s),i(y(o)).then(c=>{o.data=c,H.ssrData[o.path]=c,_t(s,r,o)}),p(C,null,s)):p(r,{...o})}function ce(t){return t.prefix&&t.children.forEach(n=>{n.attrs.path=W(t.prefix+n.attrs.path)}),kt()?p(Zt,{...t}):p(vt,{...t})}function _t(t,n,e){const r=Gt(p(n,{...e})),o=Y.indexOf(t);Y.splice(o,1);const s=H.currentTemplate.replace(t,r);H.currentTemplate=s}function tt(t){const{getInitialProps:n}=t.prototype;if(n&&h(n))return n}function ue(t){J(t.to)||(t.to=Qt(t.to));const n=d.mode==="hash"?`${d.base}#${t.to}`:d.base+t.to;function e(r){r.preventDefault(),t.type==="push"?Nt(t.to):Pt(t.to)}return p("a",{className:t.className,href:n,onclick:e},t.children)}const G=Symbol("action");function te(t){return h(t)&&t.prototype[G]===G}var _;class ee{constructor(n,e){E(this,"state");E(this,"actions");lt(this,_,!0);this.state=F(y(n)),this.actions={};for(const r in e){let s=function(...i){I(o,_,!1);const c=e[r](...i);if(R(c)&&c[Symbol.toStringTag]==="Promise")c.then(u=>(o._merge(n),M(()=>I(o,_,!0)),u));else return o._merge(n),M(()=>I(o,_,!0)),c};const o=this;s.prototype[G]=G,o.actions[r]=s}Object.assign(this.state,this.actions);for(const r in this.actions)Object.defineProperty(this.state,r,{writable:!1});Ot(()=>this.state,()=>{at(this,_)&&(console.error("Failed to update state."),this._merge(n))},{deep:!0})}_merge(n){const e=Object.keys(n);for(const r in n)this.state[r]=n[r];for(const r in this.state)te(this.state[r])||!e.includes(r)&&delete this.state[r]}}_=new WeakMap;const Z=new WeakMap;function fe(t,n){return()=>{if(!Z.has(t)){const e=new ee(t,n);Z.set(t,e.state)}return Z.get(t)}}export{C as F,ue as L,ce as R,ie as a,oe as b,fe as c,p as h,se as i,Bt as r};
