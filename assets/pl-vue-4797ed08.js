var bt=Object.defineProperty;var St=(t,n,e)=>n in t?bt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e;var d=(t,n,e)=>(St(t,typeof n!="symbol"?n+"":n,e),e),tt=(t,n,e)=>{if(!n.has(t))throw TypeError("Cannot "+e)};var et=(t,n,e)=>(tt(t,n,"read from private field"),e?e.call(t):n.get(t)),nt=(t,n,e)=>{if(n.has(t))throw TypeError("Cannot add the same private member more than once");n instanceof WeakSet?n.add(t):n.set(t,e)},M=(t,n,e,o)=>(tt(t,n,"write to private field"),o?o.call(t,e):n.set(t,e),e);function $(t){return Object.prototype.toString.call(t).slice(8,-1).toLowerCase()}function y(t){return["object","array"].includes($(t))}function Rt(t,n){return Object.prototype.hasOwnProperty.call(t,n)}function z(t,n){if(y(t)&&y(n)){const e=Object.keys(t),o=Object.keys(n);if(e.length!==o.length)return!1;for(const r of e)if(!o.includes(r)||!z(t[r],n[r]))return!1;return!0}else return t===n}function at(){return typeof window=="object"}function b(t){return $(t)==="object"}function I(t){return Array.isArray(t)}function T(t){return typeof t=="string"}function E(t){Promise.resolve().then(t)}function _t(){return Number(Math.random().toString().slice(2)).toString(32)}function D(...t){console.warn(...t)}let k=null;const P=new WeakMap;function A(t){k=t,t(),k=null}function kt(t){const n=P.get(t)||[],e=n.some(o=>k===o);k&&!e&&(n.push(k),P.set(t,n))}function ot(t){const n=P.get(t);n&&n.forEach((e,o)=>{e()===!0&&(n.splice(o,1),P.set(t,n))})}const Et=new WeakMap,U=new WeakMap,F={RAW:Symbol("__v_raw"),IS_READONLY:Symbol("__v_isReadonly")};function K(t){if(!y(t)||Object.isFrozen(t))return D(`lue cannot be made reactive: ${t}`),t;if(Et.get(t))return t;let n=null;return new Proxy(t,{get(e,o,r){if(o===F.RAW)return e;if(y(e[o]))return K(e[o]);const s=Reflect.get(e,o,r);return kt(e),s},set(e,o,r,s){if(e[F.IS_READONLY])return!0;if(y(e[o])){const l=e[o],p=new Set;for(const g in r)p.add(g),this.set(l,g,r[g],s[o]);for(const g in l)p.has(g)||this.deleteProperty(l,g);return!0}if(Reflect.get(e,o,s)===r)return!0;const i=Reflect.set(e,o,r,s),u=U.get(e)||new Set;u.add(o);const a=u.size;return U.set(e,u),E(()=>{const l=Reflect.get(e,o,s);i&&l===r&&a===1&&ot(e),U.delete(e)}),i},deleteProperty(e,o){const r=Reflect.get(e,o);if(y(r)){for(const i in r)this.deleteProperty(r,i);return!0}const s=Rt(e,o),c=Reflect.deleteProperty(e,o);return n=o,E(()=>{s&&c&&r!==void 0&&o===n&&(ot(e),n=null)}),c}})}function jt(t){return!!t[F.RAW]}function lt(t){return jt(t)?t[F.RAW]:t}function Ct(t){const n=K({value:t});function e(){return n.value}function o(r){n.value=r}return[e,o]}const Ot="__v_isRef";var zt;class Mt{constructor(n){d(this,zt,!0);d(this,"__v_isShallow",!1);d(this,"_rawValue");d(this,"_value");d(this,"getSignal");d(this,"setSignal");this._rawValue=n;const[e,o]=Ct(n);this.getSignal=e,this.setSignal=o,this._value=e()}get value(){return this.getSignal()}set value(n){this.setSignal(n),this._rawValue=n}}zt=Ot;function Nt(t){return new Mt(t)}const _=function(){const t=new WeakMap,n=["null","weakset","weakmap"],e={set(o){const r=new Set;for(const s of o)r.add(_(s));return r},map(o){const r=new Map;for(const[s,c]of o.entries())r.set(s,_(c));return r}};return function(o){const r=$(o);if(typeof o!="object"||n.includes(r))return o;if(t.has(o))return t.get(o);if(e[r])return e[r](o);const s=I(o)?[]:{};Object.setPrototypeOf(s,Object.getPrototypeOf(o)),t.set(o,s);for(const c in o)s[c]=_(o[c]);return s}}();function Y(t,n){return Object.assign({},t,n)}function pt(t,n,e={}){let o=!1;if(o)return;const r=t();e.immediate&&n(r,void 0);let s=_(r),c=!0;return A(()=>{if(o)return!0;const i=t();if(y(i)){e.deep&&!z(i,s)&&(n(i,s),s=_(i));return}if(c){c=!1;return}i!==s&&(n(i,s),s=i)}),()=>{o=!0}}function j(t){return["string","number"].includes(typeof t)&&t!==""}function Pt(t){return!/^on/.test(t)}function Q(t){return b(t)&&(T(t.tag)||O(t.tag))}function h(t){return typeof t=="function"&&!O(t)}function G(t){return[void 0,null,"",!0,!1].includes(t)}function C(t){return document.createTextNode(t)}function S(t,n,...e){const o={tag:t,attrs:n||{},children:e};return h(o.tag)&&(o.tag.prototype._id=_t(),o.children.length===0&&o.attrs.children&&(o.children=o.attrs.children)),o}function H(t){return t.prototype._id}function J({children:t}){return t}const x=Symbol("Fragment");J.prototype[x]=x;function O(t){return typeof t=="function"&&t.prototype[x]===x}const rt=[];function At(){rt.forEach(t=>{t()}),rt.length=0}const ht=new WeakMap;function dt(t,n=[]){return t.forEach(e=>{b(e)&&(h(e.tag)?n.push({comp:e.tag,compId:H(e.tag),props:Y(e.attrs,{children:t})}):j(e.tag)&&dt(e.children,n))}),n}function X(t,n=[]){const e=ht.get(t)||[];return n.push(...e),e.forEach(o=>{const r=X(o.comp);n.push(...r)}),n}const Ft=new Map;function st(t){const n=X(t).map(o=>o.compId);n.unshift(H(t));const e=[];n.forEach(o=>{const r=Ft.get(o)||[];e.push(...r)}),e.forEach(o=>{o()})}const ct=[];function xt(){ct.forEach(t=>{t()}),ct.length=0}const Vt=new Map;function it(t){const n=X(t).map(o=>o.compId);n.unshift(H(t));const e=[];n.forEach(o=>{const r=Vt.get(o)||[];e.push(...r)}),e.forEach(o=>{o()})}function R(t,n,e){if(T(t))return Z(t,n,e);if(O(t))return V(e);if(h(t)){const o=Y(n,{children:e}),r=t(o);return j(r)?C(r):(ht.set(t,dt(r.children)),R(r.tag,r.attrs,r.children))}}function Z(t,n={},e=[""]){if(O(t))return R(t,n,e);const o=document.createElement(t);e.forEach(r=>{if(!G(r)){if(j(r)){const s=C(r);s.nodeValue=r,o.appendChild(s);return}if(typeof r=="function"){const s=V([r]);o.appendChild(s);return}if(I(r)){const s=V(r);o.appendChild(s);return}if(Q(r)){const s=Z(r.tag,r.attrs,r.children);o.appendChild(s);return}if(b(r)&&h(r.tag)){const s=R(r.tag,r.attrs,r.children);o.appendChild(s);return}D(`render: 不支持 ${r} 值渲染`)}});for(const r in n){const s=n[r];s&&(o[r]=s,r==="ref"&&(s.value=o),typeof s=="function"&&Pt(r)&&A(()=>{o[r]=s()}))}if(n.style&&b(n.style))for(const r in n.style){const s=n.style[r];typeof s=="function"?A(()=>o.style[r]=s()):o.style[r]=s}return o}function V(t){const n=document.createDocumentFragment();return t.forEach(e=>{if(!G(e)){if(j(e)){const o=C(e);o.nodeValue=e,n.appendChild(o);return}if(typeof e=="function"){It(n,e);return}if(I(e)){const o=V(e);n.appendChild(o);return}if(Q(e)){const o=Z(e.tag,e.attrs,e.children);n.appendChild(o);return}if(b(e)&&h(e.tag)){const o=R(e.tag,e.attrs,e.children);n.appendChild(o);return}D(`render: 不支持 ${e} 值渲染`)}}),n}function ut(t){if(j(t))return C(t);if(Q(t)||b(t)&&h(t.tag))return R(t.tag,t.attrs,t.children)}function Wt(t,n){let e=0,o=t.length-1;for(;e<=o;){var r=Math.ceil((e+o)/2);if(n===t[r].key)return r;n<t[r].key?o=r-1:n>t[r].key&&(e=r+1)}return-1}function It(t,n){let e=[],o=!0,r=null;const s=C("");t.appendChild(s),A(()=>{let c=n();if(c&&b(c)&&O(c.tag)){D("不支持响应式节点片段渲染");return}I(c)||(c=[c]),c=c.filter(u=>!G(u));let i=0;for(;i<c.length;){let u=c[i];const a=Wt(e,i);if(a>=0){if(z(u,e[a].tree)){i++;continue}const l=ut(u);if(!l){c.splice(a,1),i++;continue}const p=e[a].tree;h(p.tag)&&it(p.tag),e[a].node.parentElement.replaceChild(l,e[a].node),h(p.tag)&&st(p.tag),e[a].tree=u,e[a].node=l}else{const l=ut(u);if(!l){i++;continue}if(o)t.appendChild(l);else if(e.length===0)r??(r=s.parentElement),r.insertBefore(l,s.nextSibling);else{const p=e[e.length-1].node,g=p.nextSibling;p.parentElement.insertBefore(l,g)}e.push({key:i,tree:u,node:l})}i++}if(e.length>c.length){for(let u=c.length;u<e.length;u++){const a=e[u].tree;h(a.tag)&&it(a.tag),e[u].node.remove(),h(a.tag)&&st(a.tag)}e.splice(c.length,e.length-c.length)}o=!1})}function Qt({tag:t,attrs:n,children:e}){const o=R(t,n,e);return xt(),E(At),o}const W=Symbol("action");function Tt(t){return typeof t=="function"&&t.prototype[W]===W}var m;class Dt{constructor(n,e){d(this,"state");d(this,"actions");nt(this,m,!0);this.state=K(_(n)),this.actions={};for(const o in e){let s=function(...c){M(r,m,!1);const i=e[o](...c);if(y(i)&&i[Symbol.toStringTag]==="Promise")i.then(u=>(r._merge(n),E(()=>M(r,m,!0)),u));else return r._merge(n),E(()=>M(r,m,!0)),i};const r=this;s.prototype[W]=W,r.actions[o]=s}Object.assign(this.state,this.actions);for(const o in this.actions)Object.defineProperty(this.state,o,{writable:!1});pt(()=>this.state,()=>{et(this,m)&&(console.error("Failed to update state."),this._merge(n))},{deep:!0})}_merge(n){const e=Object.keys(n);for(const o in n)this.state[o]=n[o];for(const o in this.state)Tt(this.state[o])||!e.includes(o)&&delete this.state[o]}}m=new WeakMap;const q=new WeakMap;function Gt(t,n){return()=>{if(!q.has(t)){const e=new Dt(t,n);q.set(t,e.state)}return q.get(t)}}function L(t){const n=new URL("http://0.0.0.0"+t),e=n.pathname,o=f.routes.find(r=>e.startsWith(r.path+"/")&&r.exact===!1);return{monitor:o?o.path:e,fullPath:n.href.replace(n.origin,""),path:e,query:Kt(n.search),hash:n.hash}}function v(t){if(T(t))return t;t=t;const n=t.path;let e="";for(const s in t.query)e+=`&${s}=${t.query[s]}`;e=e?"?"+e:"";const o=t.hash?"#"+t.hash:"";return n+e+o}function Kt(t){const n={};return t.replace("?","").split("&").forEach(o=>{const[r,s]=o.split("=");r&&s&&(n[r]=s)}),n}function gt(){return f.mode==="history"?location.href.replace(location.origin+f.base,""):location.hash.slice(1)}function yt(t){const{routes:n}=f,e=n.find(r=>r.path===t);if(e)return e;const o=n[n.length-1];if(o&&o.path===void 0&&o.component)return o}function mt(t){const n=v(t);f.mode==="history"?history.pushState({},"",f.base+n):location.hash=n,B(n)}function wt(t){const n=v(t);f.mode==="history"?history.replaceState({},"",f.base+n):location.hash=n,B(n)}function N(t){history.go(t)}function Bt(){return{push:mt,replace:wt,go:N}}const f={base:"",mode:"history",ssrDataKey:"g_initialProps",routes:[]};let w=null;function Ht(t={}){if(Object.assign(f,t),at()){const n=L(gt());w=K(n)}else w??(w=L("/"));return{back:()=>N(-1),forward:()=>N(1),go:N,push:mt,replace:wt,options:f,currentRoute:lt(w)}}function B(t){const n=L(t);for(const e in n)w[e]=n[e]}let Ut,ft="/";function qt(){let t="";if(f.mode==="history")t=ft.replace(f.base,"");else{const e=ft.match(/#.*/);t=e?e[0]:""}B(t);const n=yt(w.monitor);return S(J,null,n&&S(n.component,{data:Ut}))}function Lt(t){window.addEventListener("popstate",()=>{B(gt())});const n=Nt(null);let e;return pt(()=>w.monitor,async o=>{const r=yt(o);if(!r)return;const{getInitialProps:s}=r.component.prototype;if(typeof s=="function")if(window[f.ssrDataKey])e=window[f.ssrDataKey],delete window[f.ssrDataKey];else{n.value=t.loading;const c=lt(w);e=await s(c)}n.value=r.component},{immediate:!0}),S(J,null,()=>n.value&&S(n.value,{data:e}))}function Jt(t){return at()?S(Lt,{...t}):S(qt,null)}const $t={to:"/",type:"push"};function Xt(t){t=Y($t,t);const n=T(t.to)?t.to:v(t.to),e=f.base+(f.mode==="hash"?"#"+n:n),o=Bt();function r(s){s.preventDefault(),t.type==="push"?o.push(n):o.replace(n)}return S("a",{className:t.className,href:e,onclick:r},t.children)}export{J as F,Xt as L,Jt as R,Ht as a,Qt as b,Gt as c,S as h,Nt as r};
